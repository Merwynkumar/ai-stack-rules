# debug-json.ps1
Write-Host "=== JSON File Debugger ===" -ForegroundColor Cyan
Write-Host ""

$jsonFile = "rules/python-test-name.json"

if (-not (Test-Path $jsonFile)) {
    Write-Host "‚ùå File not found: $jsonFile" -ForegroundColor Red
    exit 1
}

Write-Host "üìÅ File: $jsonFile" -ForegroundColor Yellow
Write-Host "Size: $((Get-Item $jsonFile).Length) bytes"
Write-Host ""

# Show content
Write-Host "üìÑ File content:" -ForegroundColor Yellow
Get-Content $jsonFile -Raw | Select-Object -First 200
Write-Host ""

# Check first bytes for BOM
Write-Host "üî§ First 10 bytes (hex):" -ForegroundColor Yellow
$bytes = [System.IO.File]::ReadAllBytes($jsonFile)
$bytes[0..9] | ForEach-Object { "{0:X2} " -f $_ }
Write-Host ""

# Check for UTF-8 BOM (EF BB BF)
if ($bytes[0] -eq 0xEF -and $bytes[1] -eq 0xBB -and $bytes[2] -eq 0xBF) {
    Write-Host "‚ö†Ô∏è  UTF-8 BOM detected! (EF BB BF)" -ForegroundColor Red
    Write-Host "To remove: Get-Content $jsonFile -Raw | Out-File $jsonFile -Encoding UTF8 -NoNewline"
}

# Try to validate with Python
Write-Host "‚úÖ Validating with Python..." -ForegroundColor Yellow
try {
    $content = Get-Content $jsonFile -Raw
    $null = ConvertFrom-Json $content
    Write-Host "üéâ SUCCESS: JSON is valid!" -ForegroundColor Green
} catch {
    Write-Host "‚ùå ERROR: Invalid JSON!" -ForegroundColor Red
    Write-Host "Error: $_"
    
    # Create a clean test file
    Write-Host ""
    Write-Host "üí° Creating a clean test file: rules/test-clean.json" -ForegroundColor Cyan
    @'
{
  "title": "TEST RULE",
  "category": "Test",
  "tags": ["test"],
  "content": "Test content",
  "is_official": false,
  "is_popular": false,
  "tool_slug": "cursor"
}
'@ | Out-File "rules/test-clean.json" -Encoding UTF8
    
    Write-Host "‚úÖ Clean test file created. Compare with your file."
}

Write-Host ""
Write-Host "=== Debug Complete ===" -ForegroundColor Cyan
